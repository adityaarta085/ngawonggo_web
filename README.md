## Definition

Portal Website Desa Ngawonggo.

## Quick Setup Supabase

1. Buat project baru di [Supabase](https://supabase.com/).
2. Jalankan SQL berikut di SQL Editor Supabase untuk membuat tabel dan mengaktifkan Row Level Security (RLS) atau matikan jika untuk demo cepat (tidak disarankan untuk produksi).
3. Copy `REACT_APP_SUPABASE_URL` dan `REACT_APP_SUPABASE_ANON_KEY` ke file `.env`.

### SQL Script

```sql
-- TABEL BERITA
CREATE TABLE news (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  content TEXT, -- Untuk Rich Text Editor
  image TEXT,
  video_url TEXT,
  date TEXT,
  category TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- TABEL WISATA
CREATE TABLE travel_places (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  image TEXT,
  location TEXT,
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- TABEL LEMBAGA
CREATE TABLE institutions (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  image TEXT,
  category TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- TABEL STATISTIK DESA
CREATE TABLE village_stats (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  label TEXT NOT NULL,
  value TEXT,
  icon TEXT,
  color TEXT
);

-- TABEL STATISTIK PENGUNJUNG
CREATE TABLE page_views (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  page_path TEXT NOT NULL,
  viewed_at TIMESTAMPTZ DEFAULT NOW(),
  visitor_id TEXT
);

-- SEED DATA AWAL (Opsional)
INSERT INTO village_stats (label, value, icon, color) VALUES
('Total Penduduk', '6.052', 'FaUsers', 'blue.500'),
('Luas Wilayah', '5.34 kmÂ²', 'FaMap', 'green.500'),
('Laki-laki', '3.088', 'FaMars', 'teal.500'),
('Perempuan', '2.964', 'FaVenus', 'pink.500');

INSERT INTO news (title, content, image, date, category) VALUES
('Panen Raya Kopi Arabika', 'Desa Ngawonggo merayakan panen raya kopi arabika tahun 2024...', 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e', '20 Mei 2024', 'ekonomi');

-- TABEL ADMIN (Untuk login manual)
CREATE EXTENSION IF NOT EXISTS pgcrypto;

CREATE TABLE admins (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL, -- Hashed with pgcrypto
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Matikan akses langsung dari publik (RLS aktif tanpa policy SELECT)
ALTER TABLE admins ENABLE ROW LEVEL SECURITY;

-- RPC Function untuk login aman (tanpa mengekspos tabel ke publik)
CREATE OR REPLACE FUNCTION check_admin_credentials(p_username TEXT, p_password TEXT)
RETURNS TABLE (id BIGINT, username TEXT)
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN
  RETURN QUERY
  SELECT a.id, a.username
  FROM admins a
  WHERE a.username = p_username
    AND a.password = crypt(p_password, a.password);
END;
$$;

-- Tambah user admin default (Password: admin123)
INSERT INTO admins (username, password)
VALUES ('admin', crypt('admin123', gen_salt('bf')));
```

## Tech Stack
- React JS
- Chakra UI
- Supabase (Backend & Auth)
- React Quill (Rich Text Editor)
- Recharts (Statistics)
